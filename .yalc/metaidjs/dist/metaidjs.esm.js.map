{"version":3,"file":"metaidjs.esm.js","sources":["../node_modules/style-inject/dist/style-inject.es.js","../src/popup.ts","../src/postmessage-client.ts","../src/metaidjs.ts","../src/index.ts"],"sourcesContent":["function styleInject(css, ref) {\n  if ( ref === void 0 ) ref = {};\n  var insertAt = ref.insertAt;\n\n  if (!css || typeof document === 'undefined') { return; }\n\n  var head = document.head || document.getElementsByTagName('head')[0];\n  var style = document.createElement('style');\n  style.type = 'text/css';\n\n  if (insertAt === 'top') {\n    if (head.firstChild) {\n      head.insertBefore(style, head.firstChild);\n    } else {\n      head.appendChild(style);\n    }\n  } else {\n    head.appendChild(style);\n  }\n\n  if (style.styleSheet) {\n    style.styleSheet.cssText = css;\n  } else {\n    style.appendChild(document.createTextNode(css));\n  }\n}\n\nexport default styleInject;\n","/*\r\n * @Author: ohosanna \r\n * @Date: 2020-03-18 14:45:22 \r\n * @Last Modified by: ohosanna\r\n * @Last Modified time: 2020-07-08 16:48:53\r\n */\r\n\r\nimport './styles/popup.css'\r\n\r\ninterface PopupOptionsTypes {\r\n  title?: string;\r\n  message: string;\r\n  className?: string;\r\n  showClose?: boolean;\r\n  buttonText?: string;\r\n  buttonText2?: string;\r\n  buttonUrl?: string;\r\n  buttonUrl2?: string;\r\n  buttonAction?: Function;\r\n  buttonAction2?: Function;\r\n  useCurrentWindow?:boolean;\r\n}\r\n\r\nclass Popup {\r\n  popupWrapper: HTMLElement\r\n  constructor() {\r\n    const popupEl = document.createElement('div')\r\n    popupEl.setAttribute('id', 'showmoney-popup')\r\n    document.body.appendChild(popupEl)\r\n    this.popupWrapper = popupEl\r\n  }\r\n  info(options: PopupOptionsTypes) {\r\n    this.show('info', options)\r\n  }\r\n  error(options: PopupOptionsTypes) {\r\n    this.show('error', options)\r\n  }\r\n  loading() {\r\n    console.log(this.popupWrapper)\r\n    this.show('info', {message: 'test'})\r\n  }\r\n  confirm(options: PopupOptionsTypes) {\r\n    if (!options.buttonAction) {\r\n      options.buttonAction = () => {\r\n        this.close()\r\n      }\r\n    }\r\n    this.show('confirm', options)\r\n  }\r\n  show(type: string = 'info', options: PopupOptionsTypes) {\r\n    const popupDom = this.generatePopupContent(options)\r\n    this.popupWrapper.appendChild(popupDom)\r\n    this.popupWrapper.className = type + '-popup' + ' active'\r\n  }\r\n  close() {\r\n    this.popupWrapper.className = ''\r\n    this.popupWrapper.innerHTML = ''\r\n  }\r\n  generatePopupContent(options: PopupOptionsTypes) {\r\n    const box = document.createElement('div')\r\n    box.className = 'sm-popup-box ' + (options.className ? options.className : '')\r\n\r\n    // progress\r\n    const progress = document.createElement('div')\r\n    progress.className = 'sm-linear-progress'\r\n    const bar1 = document.createElement('div')\r\n    bar1.className = 'bar bar1'\r\n    const bar2 = document.createElement('div')\r\n    bar2.className = 'bar bar2'\r\n    progress.appendChild(bar1)\r\n    progress.appendChild(bar2)\r\n    box.appendChild(progress)\r\n\r\n    // header\r\n    const popupHeader = document.createElement('header')\r\n    popupHeader.className = 'sm-popup-header'\r\n    const popupTitle = document.createElement('h2')\r\n    popupTitle.className = 'sm-popup-title'\r\n    if(options.title) {\r\n      popupTitle.innerHTML = options.title\r\n      popupHeader.appendChild(popupTitle)\r\n    }\r\n    const closeBtn = document.createElement('button')\r\n    closeBtn.className = 'sm-popup-close'\r\n    closeBtn.onclick = () => { this.close() }\r\n    if (options.showClose !== false) {\r\n      popupHeader.appendChild(closeBtn)\r\n    }\r\n\r\n    // content\r\n    const popupContent = document.createElement('div')\r\n    popupContent.className = 'sm-popup-content'\r\n    popupContent.innerHTML = options.message\r\n\r\n    // footer\r\n    const popupFooter = document.createElement('footer')\r\n    popupFooter.className = 'sm-popup-footer'\r\n    if(options.buttonText) {\r\n      const button = document.createElement('button')\r\n      button.className = 'sm-popup-btn sm-popup-btn1'\r\n      button.innerText = options.buttonText\r\n      if(options.buttonUrl) {\r\n        const url = options.buttonUrl\r\n        button.onclick = () => {\r\n          window.open(url, '_blank')\r\n        }\r\n      }\r\n      if (options.buttonAction) {\r\n        button.onclick = () => {\r\n          if (typeof options.buttonAction === 'function') options.buttonAction()\r\n        }\r\n      }\r\n      popupFooter.appendChild(button)\r\n    }\r\n    if(options.buttonText2) {\r\n      const button2 = document.createElement('button')\r\n      button2.className = 'sm-popup-btn sm-popup-btn2'\r\n      button2.innerText = options.buttonText2\r\n      if (options.buttonUrl2) {\r\n        const url = options.buttonUrl2\r\n        button2.onclick = () => {\r\n          if(options.useCurrentWindow){\r\n            window.open(url)\r\n          }else{\r\n            window.open(url, '_blank')\r\n          }\r\n        }\r\n      }\r\n      if (options.buttonAction2) {\r\n        button2.onclick = () => {\r\n          if (typeof options.buttonAction2 === 'function') options.buttonAction2()\r\n        }\r\n      }\r\n      popupFooter.appendChild(button2)\r\n    }\r\n\r\n    box.appendChild(popupHeader)\r\n    box.appendChild(popupContent)\r\n    box.appendChild(popupFooter)\r\n    return box\r\n  }\r\n}\r\n\r\nexport default new Popup()","// Import here Polyfills if needed. Recommended core-js (npm i -D core-js)\r\n// import \"core-js/fn/array.find\"\r\n// ...\r\n\r\nconst generateRandomId = ():string => {\r\n  return (Math.floor(Math.random() * 100000000000000000)).toString()\r\n}\r\n\r\ninterface ObjTypes<T> {\r\n  [key: string]: T;\r\n  [key: number]: T;\r\n}\r\n\r\nexport default class PostmessageClient {\r\n  handlers: ObjTypes<Function>\r\n  targetWindow: Window | null\r\n  _pendingMessages: []\r\n  _deliverMessages: boolean\r\n  _replayQueue: object\r\n\r\n  constructor (window: Window | null ) {\r\n    this.handlers = {}\r\n    this.targetWindow = window\r\n    this._pendingMessages = []\r\n    this._deliverMessages = false\r\n    this._replayQueue = {}\r\n  }\r\n\r\n  start() {\r\n    window.addEventListener('message', this._onMessageReceived, false)\r\n  }\r\n  finalize() {\r\n    window.removeEventListener('message', this._onMessageReceived, false)\r\n  }\r\n  subscribe(topic: string, handler: Function) {\r\n    this.handlers[topic] = handler\r\n  }\r\n  send(topic: string, payload: any, metadata = {}) {\r\n    if (!this.targetWindow) {\r\n      return console.log('请指定目标窗口')\r\n    }\r\n    const messageId = generateRandomId()\r\n    const message = {\r\n      v1: {\r\n        topic,\r\n        payload,\r\n        messageId,\r\n        ...metadata\r\n      }\r\n    }\r\n    this.targetWindow.postMessage(message, '*')\r\n    return message\r\n  }\r\n  _onMessageReceived = async (event: ObjTypes<any>) => {\r\n    if (!event.data || !event.data.v1) {\r\n      return\r\n    }\r\n    const message = event.data.v1\r\n    const handler = this.handlers[message.topic]\r\n    if (handler) {\r\n      try {\r\n        const response = await handler(message)\r\n        if (message.reply) {\r\n          this.send(`${message.topic}:reply`, response, { repliesTo: message.messageId })\r\n        }\r\n      } catch (e) {\r\n        console.error(e)\r\n        throw e\r\n      }\r\n    }\r\n  }\r\n}","import Popup from \"./popup\";\r\nimport PostmessageClient from \"./postmessage-client\";\r\n\r\ndeclare global {\r\n  interface Window {\r\n    mainFrameMessage: PostmessageClient;\r\n  }\r\n}\r\n\r\ninterface ObjTypes<T> {\r\n  [key: string]: T;\r\n  [key: number]: T;\r\n}\r\ninterface BaseParamsType {\r\n  accessToken: string;\r\n  callback?: Function;\r\n  onCancel?: Function;\r\n}\r\ninterface OauthSettingsTypes {\r\n  clientId: string;\r\n  redirectUri: string;\r\n  clientSecret?: string;\r\n  scope?: string;\r\n  responseType?: string;\r\n}\r\ninterface ResponseTypes {\r\n  code: number;\r\n  status: string;\r\n  handlerId?: string;\r\n  data: ResponseDataTypes;\r\n}\r\ninterface ResponseDataTypes {\r\n  message: string;\r\n  [key: string]: any;\r\n}\r\ninterface ConstructorOptionsTypes {\r\n  baseUri?: string;\r\n  oauthSettings: OauthSettingsTypes;\r\n  onLoaded?: Function;\r\n  onError?: Function;\r\n}\r\nexport interface NFTTypes {\r\n  txId: string;\r\n  outputIndex: number;\r\n  satoshisPrice?: number;\r\n  sellerAddress?: string;\r\n}\r\nexport interface ProtocolOptions {\r\n  nodeName: string;\r\n  version?: string;\r\n  data?: string;\r\n  dataType?: string;\r\n  encoding?: string;\r\n  parentTxId?: string;\r\n  encrypt?: number | string;\r\n  metaIdTag?: string;\r\n  keyPath?: string;\r\n  parentAddress?: string;\r\n  needConfirm?: boolean;\r\n  checkOnly?: boolean;\r\n  brfcId?: string;\r\n  path: string;\r\n  nodeKey?: string;\r\n  payCurrency?: string;\r\n  payTo?: SendToTypes[];\r\n  autoRename?: boolean;\r\n}\r\ninterface SendToTypes {\r\n  address: string;\r\n  amount: number;\r\n}\r\ninterface ProtocolParamsTypes extends ProtocolOptions, BaseParamsType {\r\n  accessToken: string;\r\n  handlerId?: string;\r\n}\r\ninterface MakeTxParamsTypes extends BaseParamsType {\r\n  payToList: SendToTypes[];\r\n}\r\n\r\nconst generateRandomId = (): string => {\r\n  return Math.floor(Math.random() * 100000000000000000).toString();\r\n};\r\nconst hasClass = (el: HTMLElement, cls: string) => {\r\n  return el.className.match(new RegExp(\"(\\\\s|^)\" + cls + \"(\\\\s|$)\"));\r\n};\r\nconst addClass = (el: HTMLElement, cls: string) => {\r\n  if (!hasClass(el, cls)) el.className += \" \" + cls;\r\n};\r\nexport class MetaIdJs {\r\n  postMessage = new PostmessageClient(window);\r\n  oauthSettings: OauthSettingsTypes;\r\n  mainFrameEl: HTMLIFrameElement | null = null;\r\n  SHOWMONEY_URL: string;\r\n  accessToken = \"\";\r\n  isInjectMainFrame = false;\r\n  isLoaded = false;\r\n  _handlers: ObjTypes<any> = {};\r\n  onLoaded: Function | undefined;\r\n  onError: Function = (res: ResponseTypes) => {\r\n    Popup.error({\r\n      message: res.data.message,\r\n    });\r\n  };\r\n\r\n  constructor(options: ConstructorOptionsTypes) {\r\n    this.SHOWMONEY_URL = options.baseUri || \"https://www.showmoney.app\";\r\n    this.onLoaded = options.onLoaded;\r\n    if (typeof options.onError === \"function\") {\r\n      this.onError = options.onError;\r\n    }\r\n    this.oauthSettings = {\r\n      ...options.oauthSettings,\r\n      clientSecret: \"\",\r\n      scope: \"app\",\r\n      responseType: \"code\",\r\n    };\r\n    this.init();\r\n  }\r\n\r\n  /**\r\n   * injectMainFrame  注入主框架\r\n   */\r\n  public injectMainFrame() {\r\n    const mainFrame = document.createElement(\"iframe\");\r\n    const mainFrameWrapper = document.createElement(\"div\");\r\n    mainFrame.setAttribute(\"id\", \"showmoney-main-frame\");\r\n    mainFrame.setAttribute(\"src\", this.SHOWMONEY_URL + \"/iframe\");\r\n    mainFrameWrapper.setAttribute(\"id\", \"mainframewrapper\");\r\n    mainFrameWrapper.setAttribute(\"style\", \"display: none;\");\r\n    mainFrameWrapper.appendChild(mainFrame);\r\n    document.body.appendChild(mainFrameWrapper);\r\n    // 报告 main-frame 载入完成\r\n    mainFrame.onload = () => {\r\n      if (mainFrame.contentWindow) {\r\n        this.mainFrameEl = mainFrame;\r\n        // 无法把postmessage实例保留，会报跨域错误\r\n        window.mainFrameMessage = new PostmessageClient(mainFrame.contentWindow);\r\n        window.mainFrameMessage.send(\"send-options\", this.oauthSettings);\r\n        // window.mainFrameMessage = mainFrameMessage\r\n        this.isInjectMainFrame = true;\r\n        // console.log('mainFrame loaded')\r\n      }\r\n    };\r\n  }\r\n  private initHandle() {\r\n    const functionObj = [\r\n      \"swapreqswapargs\",\r\n      \"estimateSwapToken2Amount\",\r\n      \"estimateSwapToken1Amount\",\r\n      \"isSupportedFt\",\r\n      \"swapft\",\r\n      \"getBalance\",\r\n      \"nftBuy\",\r\n      \"nftCancel\",\r\n      \"nftSell\",\r\n      \"genesisNFT\",\r\n      \"issueNFT\",\r\n      \"transferFT\",\r\n      \"sendTxAuto\",\r\n      \"preFetchSignRaw\",\r\n      \"createBrfcProtocolNode\",\r\n      \"sendRedEnvelope\",\r\n      \"getRedEnvelope\",\r\n      \"resumeTransaction\",\r\n      \"paytoAddress\",\r\n      \"transferNFT\",\r\n    ];\r\n    for (const item of functionObj) {\r\n      (this as any)[item] = function (params: {\r\n        accessToken: string;\r\n        callback?: Function;\r\n        data: string;\r\n      }) {\r\n        const defParams: ObjTypes<any> = params;\r\n        if (params.callback) {\r\n          const handlerId = generateRandomId();\r\n          this._handlers[handlerId] = {};\r\n          this._handlers[handlerId].callback = params.callback;\r\n          defParams.handlerId = handlerId;\r\n        }\r\n        delete defParams.callback;\r\n        window.mainFrameMessage.send(item, defParams);\r\n      };\r\n    }\r\n  }\r\n  /**\r\n   * getUserInfo\r\n   */\r\n  public getUserInfo(params: { accessToken: string; callback?: Function }) {\r\n    const defParams: ObjTypes<any> = params;\r\n    if (params.callback) {\r\n      const handlerId = generateRandomId();\r\n      this._handlers[handlerId] = {};\r\n      this._handlers[handlerId].callback = params.callback;\r\n      defParams.handlerId = handlerId;\r\n    }\r\n    delete defParams.callback;\r\n    window.mainFrameMessage.send(\"get-user-info\", defParams);\r\n  }\r\n  /**\r\n   * signMessage\r\n   */\r\n  public signMessage(params: { accessToken: string; callback?: Function; data: string }) {\r\n    const defParams: ObjTypes<any> = params;\r\n    if (params.callback) {\r\n      const handlerId = generateRandomId();\r\n      this._handlers[handlerId] = {};\r\n      this._handlers[handlerId].callback = params.callback;\r\n      defParams.handlerId = handlerId;\r\n    }\r\n    delete defParams.callback;\r\n    window.mainFrameMessage.send(\"sign-messgae\", defParams);\r\n  }\r\n  /**\r\n   * eciesEncryptData\r\n   */\r\n  public eciesEncryptData(params: { accessToken: string; callback?: Function; data: string }) {\r\n    const defParams: ObjTypes<any> = params;\r\n    if (params.callback) {\r\n      const handlerId = generateRandomId();\r\n      this._handlers[handlerId] = {};\r\n      this._handlers[handlerId].callback = params.callback;\r\n      defParams.handlerId = handlerId;\r\n    }\r\n    delete defParams.callback;\r\n    window.mainFrameMessage.send(\"ecies-encrypt-data\", defParams);\r\n  }\r\n  public eciesDecryptData(params: { accessToken: string; callback?: Function; data: string }) {\r\n    const defParams: ObjTypes<any> = params;\r\n    if (params.callback) {\r\n      const handlerId = generateRandomId();\r\n      this._handlers[handlerId] = {};\r\n      this._handlers[handlerId].callback = params.callback;\r\n      defParams.handlerId = handlerId;\r\n    }\r\n    delete defParams.callback;\r\n    window.mainFrameMessage.send(\"ecies-decrypt-data\", defParams);\r\n  }\r\n  /**\r\n   * ecdhEncryptData\r\n   */\r\n  public ecdhEncryptData(params: { accessToken: string; callback?: Function; data: string }) {\r\n    const defParams: ObjTypes<any> = params;\r\n    if (params.callback) {\r\n      const handlerId = generateRandomId();\r\n      this._handlers[handlerId] = {};\r\n      this._handlers[handlerId].callback = params.callback;\r\n      defParams.handlerId = handlerId;\r\n    }\r\n    delete defParams.callback;\r\n    window.mainFrameMessage.send(\"ecdh-encrypt-data\", defParams);\r\n  }\r\n  public ecdhDecryptData(params: { accessToken: string; callback?: Function; data: string }) {\r\n    const defParams: ObjTypes<any> = params;\r\n    if (params.callback) {\r\n      const handlerId = generateRandomId();\r\n      this._handlers[handlerId] = {};\r\n      this._handlers[handlerId].callback = params.callback;\r\n      defParams.handlerId = handlerId;\r\n    }\r\n    delete defParams.callback;\r\n    window.mainFrameMessage.send(\"ecdh-decrypt-data\", defParams);\r\n  }\r\n  /**\r\n   * nftStartAuction nft 拍卖\r\n   */\r\n  public nftStartAuction(params: {\r\n    nft: {\r\n      codehash: string;\r\n      genesis: string;\r\n      genesisTxid: string;\r\n      tokenIndex: string;\r\n      sensibleId: string;\r\n    };\r\n    startBsvPrice: number;\r\n    endTimeStamp: number;\r\n    feeAddress: string;\r\n    feeAmount: number;\r\n    useFeeb: number;\r\n    checkOnly?: boolean;\r\n    callback?: Function;\r\n  }) {\r\n    const defParams: ObjTypes<any> = params;\r\n    if (params.callback) {\r\n      const handlerId = generateRandomId();\r\n      this._handlers[handlerId] = {};\r\n      this._handlers[handlerId].callback = params.callback;\r\n      defParams.handlerId = handlerId;\r\n    }\r\n    delete defParams.callback;\r\n    window.mainFrameMessage.send(\"nft-start-auction\", defParams);\r\n  }\r\n\r\n  /**\r\n   * nftAuctionBid\r\n   */\r\n  public nftAuctionBid(params: {\r\n    nft: {\r\n      codehash: string;\r\n      genesis: string;\r\n      genesisTxid: string;\r\n      tokenIndex: string;\r\n      sensibleId: string;\r\n    };\r\n    bsvBidPrice: number;\r\n    nftAuctionId: string;\r\n    useFeeb: number;\r\n    checkOnly?: boolean;\r\n    callback?: Function;\r\n  }) {\r\n    const defParams: ObjTypes<any> = params;\r\n    if (params.callback) {\r\n      const handlerId = generateRandomId();\r\n      this._handlers[handlerId] = {};\r\n      this._handlers[handlerId].callback = params.callback;\r\n      defParams.handlerId = handlerId;\r\n    }\r\n    delete defParams.callback;\r\n    window.mainFrameMessage.send(\"nft-auction-bid\", defParams);\r\n  }\r\n\r\n  /**\r\n   * nftAuctionWithdraw\r\n   */\r\n  public nftAuctionWithdraw(params: {\r\n    nft: {\r\n      codehash: string;\r\n      genesis: string;\r\n      genesisTxid: string;\r\n      tokenIndex: string;\r\n      sensibleId: string;\r\n    };\r\n    nftAuctionId: string;\r\n    useFeeb: number;\r\n    checkOnly?: boolean;\r\n    callback?: Function;\r\n  }) {\r\n    const defParams: ObjTypes<any> = params;\r\n    if (params.callback) {\r\n      const handlerId = generateRandomId();\r\n      this._handlers[handlerId] = {};\r\n      this._handlers[handlerId].callback = params.callback;\r\n      defParams.handlerId = handlerId;\r\n    }\r\n    delete defParams.callback;\r\n    window.mainFrameMessage.send(\"nft-auction-withdraw\", defParams);\r\n  }\r\n\r\n  public getFTList(params: { accessToken: string; callback?: Function; data?: string }) {\r\n    const defParams: ObjTypes<any> = params;\r\n    if (params.callback) {\r\n      const handlerId = generateRandomId();\r\n      this._handlers[handlerId] = {};\r\n      this._handlers[handlerId].callback = params.callback;\r\n      defParams.handlerId = handlerId;\r\n    }\r\n    delete defParams.callback;\r\n    window.mainFrameMessage.send(\"get-ftlist\", defParams);\r\n  }\r\n  // 版本兼容\r\n  public addProtocolNode(params: ProtocolParamsTypes) {\r\n    this.sendMetaDataTx(params);\r\n  }\r\n  /**\r\n   * createProtocolNode\r\n   */\r\n  public sendMetaDataTx(params: ProtocolParamsTypes) {\r\n    if (!params.needConfirm === false && !params.checkOnly) {\r\n      this.showLoadingPopup();\r\n    }\r\n    if (params.callback || params.onCancel) {\r\n      const handlerId = generateRandomId();\r\n      this._handlers[handlerId] = {};\r\n      if (params.callback) {\r\n        this._handlers[handlerId][\"callback\"] = params.callback;\r\n      }\r\n      if (params.onCancel) {\r\n        this._handlers[handlerId][\"onCancel\"] = params.onCancel;\r\n      }\r\n      params = {\r\n        ...params,\r\n        handlerId: handlerId,\r\n      };\r\n      delete params.callback;\r\n      delete params.onCancel;\r\n    }\r\n    if (this.isInjectMainFrame) {\r\n      window.mainFrameMessage.send(\"create-node\", params);\r\n      // console.log(this._handlers)\r\n    } else {\r\n      throw new Error(\"showmoney frame 未加载\");\r\n    }\r\n  }\r\n\r\n  public makeTx(params: MakeTxParamsTypes) {\r\n    const defParams: ObjTypes<any> = params;\r\n    if (params.callback) {\r\n      const handlerId = generateRandomId();\r\n      this._handlers[handlerId] = {};\r\n      this._handlers[handlerId].callback = params.callback;\r\n      defParams.handlerId = handlerId;\r\n    }\r\n    delete defParams.callback;\r\n    window.mainFrameMessage.send(\"make-tx\", defParams);\r\n  }\r\n\r\n  public payToAddress(params: { accessToken: string; callback?: Function; data: string }) {\r\n    const defParams: ObjTypes<any> = params;\r\n    if (params.callback) {\r\n      const handlerId = generateRandomId();\r\n      this._handlers[handlerId] = {};\r\n      this._handlers[handlerId].callback = params.callback;\r\n      defParams.handlerId = handlerId;\r\n    }\r\n    delete defParams.callback;\r\n    window.mainFrameMessage.send(\"pay-to-address\", defParams);\r\n  }\r\n  private handleCreateNodeSuccess = (res: ObjTypes<any>) => {\r\n    Popup.close();\r\n    this.mainFrameEl?.parentElement?.setAttribute(\"style\", \"display: none;\");\r\n    const payload = res.payload;\r\n    const callback = this._handlers[payload.handlerId].callback;\r\n    if (callback) {\r\n      callback(payload);\r\n    }\r\n  };\r\n  private showLoadingPopup() {\r\n    const popupEl = document.getElementById(\"showmoney-popup\");\r\n    if (!popupEl) return;\r\n    Popup.info({\r\n      message: \"Processing data...\",\r\n      showClose: false,\r\n    });\r\n    addClass(popupEl, \"loading\");\r\n  }\r\n  private handleCreateNodeError = (res: ObjTypes<any>) => {\r\n    const payload = res.payload;\r\n    Popup.close();\r\n    Popup.error({\r\n      message: payload.data && payload.data.message ? payload.data.message : res,\r\n    });\r\n  };\r\n  private handleConfirmCreateNode = (res: ObjTypes<any>) => {\r\n    // console.log(\"confirm\", res);\r\n    Popup.close();\r\n    this.mainFrameEl?.parentElement?.removeAttribute(\"style\");\r\n  };\r\n  private handleCloseCreateNode = (res: ObjTypes<any>) => {\r\n    Popup.close();\r\n    this.mainFrameEl?.parentElement?.setAttribute(\"style\", \"display: none;\");\r\n    const payload = res.payload;\r\n    const callback = this._handlers[payload.handlerId].onCancel;\r\n    if (callback) {\r\n      delete payload.handlerId;\r\n      callback(payload);\r\n    }\r\n  };\r\n  private handleErrorNotLoggedIn(resolve: ObjTypes<any>) {\r\n    const message = resolve.payload;\r\n    Popup.close();\r\n    Popup.info(message.popup);\r\n  }\r\n  private handleCallback = (res: ObjTypes<any>) => {\r\n    const payload = res.payload;\r\n    const callback = this._handlers[payload.handlerId].callback;\r\n    if (callback) {\r\n      delete payload.handlerId;\r\n      callback(payload);\r\n    }\r\n  };\r\n  private handleSdkLoaded = () => {\r\n    this.isLoaded = true;\r\n    if (typeof this.onLoaded === \"function\") {\r\n      this.onLoaded();\r\n    }\r\n  };\r\n  private handleCommonError = (res: ObjTypes<any>) => {\r\n    console.log(\"error\", res);\r\n    const payload = res.payload;\r\n    Popup.close();\r\n    if (payload.code === 202) {\r\n      Popup.confirm({\r\n        message: \"User authentication expired.\",\r\n        showClose: false,\r\n        buttonText: \"Cancel\",\r\n        buttonText2: \"Login\",\r\n        buttonUrl2: `${this.SHOWMONEY_URL}/userLogin?response_type=code&client_id=${this.oauthSettings.clientId}&redirect_uri=${this.oauthSettings.redirectUri}&scope=app&from=${this.oauthSettings.redirectUri}`,\r\n      });\r\n    } else {\r\n      this.onError(payload);\r\n    }\r\n  };\r\n  private handleLoading = () => {\r\n    this.showLoadingPopup();\r\n  };\r\n  private handleNotEnoughMoney = (res: ObjTypes<any>) => {\r\n    const payload = res.payload;\r\n    const message = payload.data.message;\r\n    Popup.close();\r\n    Popup.confirm({\r\n      message: message ? message : \"Not enough money\",\r\n      showClose: false,\r\n      buttonText: \"Cancel\",\r\n      buttonText2: \"Top up BSV\",\r\n      buttonUrl2: this.SHOWMONEY_URL,\r\n      buttonAction: () => {\r\n        Popup.close();\r\n        if ((window as any).handleNotEnoughMoney) {\r\n          (window as any).handleNotEnoughMoney(payload);\r\n        }\r\n        // const callback = this._handlers[payload.handlerId].callback\r\n        // if (callback) {\r\n        //   callback(payload)\r\n        // }\r\n      },\r\n    });\r\n  };\r\n  private init() {\r\n    this.injectMainFrame();\r\n\r\n    // 监听信息\r\n    this.postMessage.start();\r\n    this.initHandle();\r\n    this.postMessage.subscribe(\"sdk-loaded\", this.handleSdkLoaded);\r\n    this.postMessage.subscribe(\"error.not-logged-in\", this.handleErrorNotLoggedIn);\r\n    this.postMessage.subscribe(\"loading\", this.handleLoading);\r\n    this.postMessage.subscribe(\"success.create-node\", this.handleCreateNodeSuccess);\r\n    this.postMessage.subscribe(\"confirm.create-node\", this.handleConfirmCreateNode);\r\n    this.postMessage.subscribe(\"close.create-node\", this.handleCloseCreateNode);\r\n    this.postMessage.subscribe(\"error.create-node\", this.handleCreateNodeError);\r\n    this.postMessage.subscribe(\"error.not-enough-money\", this.handleNotEnoughMoney);\r\n    this.postMessage.subscribe(\"receive-callback\", this.handleCallback);\r\n    this.postMessage.subscribe(\"error.common\", this.handleCommonError);\r\n  }\r\n}\r\n","import { MetaIdJs } from \"./metaidjs\"\r\n\r\ndeclare global {\r\n  interface Window {\r\n    MetaIdJs?: Function; \r\n    handleNotEnoughMoney?: Function; \r\n  }\r\n}\r\n\r\nwindow.MetaIdJs = MetaIdJs\r\n\r\nexport default MetaIdJs"],"names":["generateRandomId","Popup"],"mappings":"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"}