{"version":3,"file":"metaidjs.udm.js","sources":["../node_modules/style-inject/dist/style-inject.es.js","../src/popup.ts","../src/postmessage-client.ts","../src/metaidjs.ts","../src/index.ts"],"sourcesContent":["function styleInject(css, ref) {\n  if ( ref === void 0 ) ref = {};\n  var insertAt = ref.insertAt;\n\n  if (!css || typeof document === 'undefined') { return; }\n\n  var head = document.head || document.getElementsByTagName('head')[0];\n  var style = document.createElement('style');\n  style.type = 'text/css';\n\n  if (insertAt === 'top') {\n    if (head.firstChild) {\n      head.insertBefore(style, head.firstChild);\n    } else {\n      head.appendChild(style);\n    }\n  } else {\n    head.appendChild(style);\n  }\n\n  if (style.styleSheet) {\n    style.styleSheet.cssText = css;\n  } else {\n    style.appendChild(document.createTextNode(css));\n  }\n}\n\nexport default styleInject;\n","/*\r\n * @Author: ohosanna \r\n * @Date: 2020-03-18 14:45:22 \r\n * @Last Modified by: ohosanna\r\n * @Last Modified time: 2020-07-08 16:48:53\r\n */\r\n\r\nimport './styles/popup.css'\r\n\r\ninterface PopupOptionsTypes {\r\n  title?: string;\r\n  message: string;\r\n  className?: string;\r\n  showClose?: boolean;\r\n  buttonText?: string;\r\n  buttonText2?: string;\r\n  buttonUrl?: string;\r\n  buttonUrl2?: string;\r\n  buttonAction?: Function;\r\n  buttonAction2?: Function;\r\n  useCurrentWindow?:boolean;\r\n}\r\n\r\nclass Popup {\r\n  popupWrapper: HTMLElement\r\n  constructor() {\r\n    const popupEl = document.createElement('div')\r\n    popupEl.setAttribute('id', 'showmoney-popup')\r\n    document.body.appendChild(popupEl)\r\n    this.popupWrapper = popupEl\r\n  }\r\n  info(options: PopupOptionsTypes) {\r\n    this.show('info', options)\r\n  }\r\n  error(options: PopupOptionsTypes) {\r\n    this.show('error', options)\r\n  }\r\n  loading() {\r\n    console.log(this.popupWrapper)\r\n    this.show('info', {message: 'test'})\r\n  }\r\n  confirm(options: PopupOptionsTypes) {\r\n    if (!options.buttonAction) {\r\n      options.buttonAction = () => {\r\n        this.close()\r\n      }\r\n    }\r\n    this.show('confirm', options)\r\n  }\r\n  show(type: string = 'info', options: PopupOptionsTypes) {\r\n    const popupDom = this.generatePopupContent(options)\r\n    this.popupWrapper.appendChild(popupDom)\r\n    this.popupWrapper.className = type + '-popup' + ' active'\r\n  }\r\n  close() {\r\n    this.popupWrapper.className = ''\r\n    this.popupWrapper.innerHTML = ''\r\n  }\r\n  generatePopupContent(options: PopupOptionsTypes) {\r\n    const box = document.createElement('div')\r\n    box.className = 'sm-popup-box ' + (options.className ? options.className : '')\r\n\r\n    // progress\r\n    const progress = document.createElement('div')\r\n    progress.className = 'sm-linear-progress'\r\n    const bar1 = document.createElement('div')\r\n    bar1.className = 'bar bar1'\r\n    const bar2 = document.createElement('div')\r\n    bar2.className = 'bar bar2'\r\n    progress.appendChild(bar1)\r\n    progress.appendChild(bar2)\r\n    box.appendChild(progress)\r\n\r\n    // header\r\n    const popupHeader = document.createElement('header')\r\n    popupHeader.className = 'sm-popup-header'\r\n    const popupTitle = document.createElement('h2')\r\n    popupTitle.className = 'sm-popup-title'\r\n    if(options.title) {\r\n      popupTitle.innerHTML = options.title\r\n      popupHeader.appendChild(popupTitle)\r\n    }\r\n    const closeBtn = document.createElement('button')\r\n    closeBtn.className = 'sm-popup-close'\r\n    closeBtn.onclick = () => { this.close() }\r\n    if (options.showClose !== false) {\r\n      popupHeader.appendChild(closeBtn)\r\n    }\r\n\r\n    // content\r\n    const popupContent = document.createElement('div')\r\n    popupContent.className = 'sm-popup-content'\r\n    popupContent.innerHTML = options.message\r\n\r\n    // footer\r\n    const popupFooter = document.createElement('footer')\r\n    popupFooter.className = 'sm-popup-footer'\r\n    if(options.buttonText) {\r\n      const button = document.createElement('button')\r\n      button.className = 'sm-popup-btn sm-popup-btn1'\r\n      button.innerText = options.buttonText\r\n      if(options.buttonUrl) {\r\n        const url = options.buttonUrl\r\n        button.onclick = () => {\r\n          window.open(url, '_blank')\r\n        }\r\n      }\r\n      if (options.buttonAction) {\r\n        button.onclick = () => {\r\n          if (typeof options.buttonAction === 'function') options.buttonAction()\r\n        }\r\n      }\r\n      popupFooter.appendChild(button)\r\n    }\r\n    if(options.buttonText2) {\r\n      const button2 = document.createElement('button')\r\n      button2.className = 'sm-popup-btn sm-popup-btn2'\r\n      button2.innerText = options.buttonText2\r\n      if (options.buttonUrl2) {\r\n        const url = options.buttonUrl2\r\n        button2.onclick = () => {\r\n          if(options.useCurrentWindow){\r\n            window.open(url)\r\n          }else{\r\n            window.open(url, '_blank')\r\n          }\r\n        }\r\n      }\r\n      if (options.buttonAction2) {\r\n        button2.onclick = () => {\r\n          if (typeof options.buttonAction2 === 'function') options.buttonAction2()\r\n        }\r\n      }\r\n      popupFooter.appendChild(button2)\r\n    }\r\n\r\n    box.appendChild(popupHeader)\r\n    box.appendChild(popupContent)\r\n    box.appendChild(popupFooter)\r\n    return box\r\n  }\r\n}\r\n\r\nexport default new Popup()","// Import here Polyfills if needed. Recommended core-js (npm i -D core-js)\r\n// import \"core-js/fn/array.find\"\r\n// ...\r\n\r\nconst generateRandomId = ():string => {\r\n  return (Math.floor(Math.random() * 100000000000000000)).toString()\r\n}\r\n\r\ninterface ObjTypes<T> {\r\n  [key: string]: T;\r\n  [key: number]: T;\r\n}\r\n\r\nexport default class PostmessageClient {\r\n  handlers: ObjTypes<Function>\r\n  targetWindow: Window | null\r\n  _pendingMessages: []\r\n  _deliverMessages: boolean\r\n  _replayQueue: object\r\n\r\n  constructor (window: Window | null ) {\r\n    this.handlers = {}\r\n    this.targetWindow = window\r\n    this._pendingMessages = []\r\n    this._deliverMessages = false\r\n    this._replayQueue = {}\r\n  }\r\n\r\n  start() {\r\n    window.addEventListener('message', this._onMessageReceived, false)\r\n  }\r\n  finalize() {\r\n    window.removeEventListener('message', this._onMessageReceived, false)\r\n  }\r\n  subscribe(topic: string, handler: Function) {\r\n    this.handlers[topic] = handler\r\n  }\r\n  send(topic: string, payload: any, metadata = {}) {\r\n    if (!this.targetWindow) {\r\n      return console.log('请指定目标窗口')\r\n    }\r\n    const messageId = generateRandomId()\r\n    const message = {\r\n      v1: {\r\n        topic,\r\n        payload,\r\n        messageId,\r\n        ...metadata\r\n      }\r\n    }\r\n    this.targetWindow.postMessage(message, '*')\r\n    return message\r\n  }\r\n  _onMessageReceived = async (event: ObjTypes<any>) => {\r\n    if (!event.data || !event.data.v1) {\r\n      return\r\n    }\r\n    const message = event.data.v1\r\n    const handler = this.handlers[message.topic]\r\n    if (handler) {\r\n      try {\r\n        const response = await handler(message)\r\n        if (message.reply) {\r\n          this.send(`${message.topic}:reply`, response, { repliesTo: message.messageId })\r\n        }\r\n      } catch (e) {\r\n        console.error(e)\r\n        throw e\r\n      }\r\n    }\r\n  }\r\n}","import Popup from \"./popup\";\r\nimport PostmessageClient from \"./postmessage-client\";\r\n\r\ndeclare global {\r\n  interface Window {\r\n    mainFrameMessage: PostmessageClient;\r\n  }\r\n}\r\n\r\ninterface ObjTypes<T> {\r\n  [key: string]: T;\r\n  [key: number]: T;\r\n}\r\ninterface BaseParamsType {\r\n  accessToken: string;\r\n  callback?: Function;\r\n  onCancel?: Function;\r\n}\r\ninterface OauthSettingsTypes {\r\n  clientId: string;\r\n  redirectUri: string;\r\n  clientSecret?: string;\r\n  scope?: string;\r\n  responseType?: string;\r\n}\r\ninterface ResponseTypes {\r\n  code: number;\r\n  status: string;\r\n  handlerId?: string;\r\n  data: ResponseDataTypes;\r\n}\r\ninterface ResponseDataTypes {\r\n  message: string;\r\n  [key: string]: any;\r\n}\r\ninterface ConstructorOptionsTypes {\r\n  baseUri?: string;\r\n  oauthSettings: OauthSettingsTypes;\r\n  onLoaded?: Function;\r\n  onError?: Function;\r\n}\r\nexport interface NFTTypes {\r\n  txId: string;\r\n  outputIndex: number;\r\n  satoshisPrice?: number;\r\n  sellerAddress?: string;\r\n}\r\nexport interface ProtocolOptions {\r\n  nodeName: string;\r\n  version?: string;\r\n  data?: string;\r\n  dataType?: string;\r\n  encoding?: string;\r\n  parentTxId?: string;\r\n  encrypt?: number | string;\r\n  metaIdTag?: string;\r\n  keyPath?: string;\r\n  parentAddress?: string;\r\n  needConfirm?: boolean;\r\n  checkOnly?: boolean;\r\n  brfcId?: string;\r\n  path: string;\r\n  nodeKey?: string;\r\n  payCurrency?: string;\r\n  payTo?: SendToTypes[];\r\n  autoRename?: boolean;\r\n}\r\ninterface SendToTypes {\r\n  address: string;\r\n  amount: number;\r\n}\r\ninterface ProtocolParamsTypes extends ProtocolOptions, BaseParamsType {\r\n  accessToken: string;\r\n  handlerId?: string;\r\n}\r\ninterface MakeTxParamsTypes extends BaseParamsType {\r\n  payToList: SendToTypes[];\r\n}\r\n\r\nconst generateRandomId = (): string => {\r\n  return Math.floor(Math.random() * 100000000000000000).toString();\r\n};\r\nconst hasClass = (el: HTMLElement, cls: string) => {\r\n  return el.className.match(new RegExp(\"(\\\\s|^)\" + cls + \"(\\\\s|$)\"));\r\n};\r\nconst addClass = (el: HTMLElement, cls: string) => {\r\n  if (!hasClass(el, cls)) el.className += \" \" + cls;\r\n};\r\nexport class MetaIdJs {\r\n  postMessage = new PostmessageClient(window);\r\n  oauthSettings: OauthSettingsTypes;\r\n  mainFrameEl: HTMLIFrameElement | null = null;\r\n  SHOWMONEY_URL: string;\r\n  accessToken = \"\";\r\n  isInjectMainFrame = false;\r\n  isLoaded = false;\r\n  _handlers: ObjTypes<any> = {};\r\n  onLoaded: Function | undefined;\r\n  onError: Function = (res: ResponseTypes) => {\r\n    Popup.error({\r\n      message: res.data.message,\r\n    });\r\n  };\r\n\r\n  constructor(options: ConstructorOptionsTypes) {\r\n    this.SHOWMONEY_URL = options.baseUri || \"https://www.showmoney.app\";\r\n    this.onLoaded = options.onLoaded;\r\n    if (typeof options.onError === \"function\") {\r\n      this.onError = options.onError;\r\n    }\r\n    this.oauthSettings = {\r\n      ...options.oauthSettings,\r\n      clientSecret: \"\",\r\n      scope: \"app\",\r\n      responseType: \"code\",\r\n    };\r\n    this.init();\r\n  }\r\n\r\n  /**\r\n   * injectMainFrame  注入主框架\r\n   */\r\n  public injectMainFrame() {\r\n    const mainFrame = document.createElement(\"iframe\");\r\n    const mainFrameWrapper = document.createElement(\"div\");\r\n    mainFrame.setAttribute(\"id\", \"showmoney-main-frame\");\r\n    mainFrame.setAttribute(\"src\", this.SHOWMONEY_URL + \"/iframe\");\r\n    mainFrameWrapper.setAttribute(\"id\", \"mainframewrapper\");\r\n    mainFrameWrapper.setAttribute(\"style\", \"display: none;\");\r\n    mainFrameWrapper.appendChild(mainFrame);\r\n    document.body.appendChild(mainFrameWrapper);\r\n    // 报告 main-frame 载入完成\r\n    mainFrame.onload = () => {\r\n      if (mainFrame.contentWindow) {\r\n        this.mainFrameEl = mainFrame;\r\n        // 无法把postmessage实例保留，会报跨域错误\r\n        window.mainFrameMessage = new PostmessageClient(mainFrame.contentWindow);\r\n        window.mainFrameMessage.send(\"send-options\", this.oauthSettings);\r\n        // window.mainFrameMessage = mainFrameMessage\r\n        this.isInjectMainFrame = true;\r\n        // console.log('mainFrame loaded')\r\n      }\r\n    };\r\n  }\r\n  private initHandle() {\r\n    const functionObj = [\r\n      \"swapreqswapargs\",\r\n      \"estimateSwapToken2Amount\",\r\n      \"estimateSwapToken1Amount\",\r\n      \"isSupportedFt\",\r\n      \"swapft\",\r\n      \"getBalance\",\r\n      \"nftBuy\",\r\n      \"nftCancel\",\r\n      \"nftSell\",\r\n      \"genesisNFT\",\r\n      \"issueNFT\",\r\n      \"transferFT\",\r\n      \"sendTxAuto\",\r\n      \"preFetchSignRaw\",\r\n      \"createBrfcProtocolNode\",\r\n      \"sendRedEnvelope\",\r\n      \"getRedEnvelope\",\r\n      \"resumeTransaction\",\r\n      \"paytoAddress\",\r\n      \"transferNFT\",\r\n    ];\r\n    for (const item of functionObj) {\r\n      (this as any)[item] = function (params: {\r\n        accessToken: string;\r\n        callback?: Function;\r\n        data: string;\r\n      }) {\r\n        const defParams: ObjTypes<any> = params;\r\n        if (params.callback) {\r\n          const handlerId = generateRandomId();\r\n          this._handlers[handlerId] = {};\r\n          this._handlers[handlerId].callback = params.callback;\r\n          defParams.handlerId = handlerId;\r\n        }\r\n        delete defParams.callback;\r\n        window.mainFrameMessage.send(item, defParams);\r\n      };\r\n    }\r\n  }\r\n  /**\r\n   * getUserInfo\r\n   */\r\n  public getUserInfo(params: { accessToken: string; callback?: Function }) {\r\n    const defParams: ObjTypes<any> = params;\r\n    if (params.callback) {\r\n      const handlerId = generateRandomId();\r\n      this._handlers[handlerId] = {};\r\n      this._handlers[handlerId].callback = params.callback;\r\n      defParams.handlerId = handlerId;\r\n    }\r\n    delete defParams.callback;\r\n    window.mainFrameMessage.send(\"get-user-info\", defParams);\r\n  }\r\n  /**\r\n   * signMessage\r\n   */\r\n  public signMessage(params: { accessToken: string; callback?: Function; data: string }) {\r\n    const defParams: ObjTypes<any> = params;\r\n    if (params.callback) {\r\n      const handlerId = generateRandomId();\r\n      this._handlers[handlerId] = {};\r\n      this._handlers[handlerId].callback = params.callback;\r\n      defParams.handlerId = handlerId;\r\n    }\r\n    delete defParams.callback;\r\n    window.mainFrameMessage.send(\"sign-messgae\", defParams);\r\n  }\r\n  /**\r\n   * eciesEncryptData\r\n   */\r\n  public eciesEncryptData(params: { accessToken: string; callback?: Function; data: string }) {\r\n    const defParams: ObjTypes<any> = params;\r\n    if (params.callback) {\r\n      const handlerId = generateRandomId();\r\n      this._handlers[handlerId] = {};\r\n      this._handlers[handlerId].callback = params.callback;\r\n      defParams.handlerId = handlerId;\r\n    }\r\n    delete defParams.callback;\r\n    window.mainFrameMessage.send(\"ecies-encrypt-data\", defParams);\r\n  }\r\n  public eciesDecryptData(params: { accessToken: string; callback?: Function; data: string }) {\r\n    const defParams: ObjTypes<any> = params;\r\n    if (params.callback) {\r\n      const handlerId = generateRandomId();\r\n      this._handlers[handlerId] = {};\r\n      this._handlers[handlerId].callback = params.callback;\r\n      defParams.handlerId = handlerId;\r\n    }\r\n    delete defParams.callback;\r\n    window.mainFrameMessage.send(\"ecies-decrypt-data\", defParams);\r\n  }\r\n  /**\r\n   * ecdhEncryptData\r\n   */\r\n  public ecdhEncryptData(params: { accessToken: string; callback?: Function; data: string }) {\r\n    const defParams: ObjTypes<any> = params;\r\n    if (params.callback) {\r\n      const handlerId = generateRandomId();\r\n      this._handlers[handlerId] = {};\r\n      this._handlers[handlerId].callback = params.callback;\r\n      defParams.handlerId = handlerId;\r\n    }\r\n    delete defParams.callback;\r\n    window.mainFrameMessage.send(\"ecdh-encrypt-data\", defParams);\r\n  }\r\n  public ecdhDecryptData(params: { accessToken: string; callback?: Function; data: string }) {\r\n    const defParams: ObjTypes<any> = params;\r\n    if (params.callback) {\r\n      const handlerId = generateRandomId();\r\n      this._handlers[handlerId] = {};\r\n      this._handlers[handlerId].callback = params.callback;\r\n      defParams.handlerId = handlerId;\r\n    }\r\n    delete defParams.callback;\r\n    window.mainFrameMessage.send(\"ecdh-decrypt-data\", defParams);\r\n  }\r\n  /**\r\n   * nftStartAuction nft 拍卖\r\n   */\r\n  public nftStartAuction(params: {\r\n    nft: {\r\n      codehash: string;\r\n      genesis: string;\r\n      genesisTxid: string;\r\n      tokenIndex: string;\r\n      sensibleId: string;\r\n    };\r\n    startBsvPrice: number;\r\n    endTimeStamp: number;\r\n    feeAddress: string;\r\n    feeAmount: number;\r\n    useFeeb: number;\r\n    checkOnly?: boolean;\r\n    callback?: Function;\r\n  }) {\r\n    const defParams: ObjTypes<any> = params;\r\n    if (params.callback) {\r\n      const handlerId = generateRandomId();\r\n      this._handlers[handlerId] = {};\r\n      this._handlers[handlerId].callback = params.callback;\r\n      defParams.handlerId = handlerId;\r\n    }\r\n    delete defParams.callback;\r\n    window.mainFrameMessage.send(\"nft-start-auction\", defParams);\r\n  }\r\n\r\n  /**\r\n   * nftAuctionBid\r\n   */\r\n  public nftAuctionBid(params: {\r\n    nft: {\r\n      codehash: string;\r\n      genesis: string;\r\n      genesisTxid: string;\r\n      tokenIndex: string;\r\n      sensibleId: string;\r\n    };\r\n    bsvBidPrice: number;\r\n    nftAuctionId: string;\r\n    useFeeb: number;\r\n    checkOnly?: boolean;\r\n    callback?: Function;\r\n  }) {\r\n    const defParams: ObjTypes<any> = params;\r\n    if (params.callback) {\r\n      const handlerId = generateRandomId();\r\n      this._handlers[handlerId] = {};\r\n      this._handlers[handlerId].callback = params.callback;\r\n      defParams.handlerId = handlerId;\r\n    }\r\n    delete defParams.callback;\r\n    window.mainFrameMessage.send(\"nft-auction-bid\", defParams);\r\n  }\r\n\r\n  /**\r\n   * nftAuctionWithdraw\r\n   */\r\n  public nftAuctionWithdraw(params: {\r\n    nft: {\r\n      codehash: string;\r\n      genesis: string;\r\n      genesisTxid: string;\r\n      tokenIndex: string;\r\n      sensibleId: string;\r\n    };\r\n    nftAuctionId: string;\r\n    useFeeb: number;\r\n    checkOnly?: boolean;\r\n    callback?: Function;\r\n  }) {\r\n    const defParams: ObjTypes<any> = params;\r\n    if (params.callback) {\r\n      const handlerId = generateRandomId();\r\n      this._handlers[handlerId] = {};\r\n      this._handlers[handlerId].callback = params.callback;\r\n      defParams.handlerId = handlerId;\r\n    }\r\n    delete defParams.callback;\r\n    window.mainFrameMessage.send(\"nft-auction-withdraw\", defParams);\r\n  }\r\n\r\n  public getFTList(params: { accessToken: string; callback?: Function; data?: string }) {\r\n    const defParams: ObjTypes<any> = params;\r\n    if (params.callback) {\r\n      const handlerId = generateRandomId();\r\n      this._handlers[handlerId] = {};\r\n      this._handlers[handlerId].callback = params.callback;\r\n      defParams.handlerId = handlerId;\r\n    }\r\n    delete defParams.callback;\r\n    window.mainFrameMessage.send(\"get-ftlist\", defParams);\r\n  }\r\n  // 版本兼容\r\n  public addProtocolNode(params: ProtocolParamsTypes) {\r\n    this.sendMetaDataTx(params);\r\n  }\r\n  /**\r\n   * createProtocolNode\r\n   */\r\n  public sendMetaDataTx(params: ProtocolParamsTypes) {\r\n    if (!params.needConfirm === false && !params.checkOnly) {\r\n      this.showLoadingPopup();\r\n    }\r\n    if (params.callback || params.onCancel) {\r\n      const handlerId = generateRandomId();\r\n      this._handlers[handlerId] = {};\r\n      if (params.callback) {\r\n        this._handlers[handlerId][\"callback\"] = params.callback;\r\n      }\r\n      if (params.onCancel) {\r\n        this._handlers[handlerId][\"onCancel\"] = params.onCancel;\r\n      }\r\n      params = {\r\n        ...params,\r\n        handlerId: handlerId,\r\n      };\r\n      delete params.callback;\r\n      delete params.onCancel;\r\n    }\r\n    if (this.isInjectMainFrame) {\r\n      window.mainFrameMessage.send(\"create-node\", params);\r\n      // console.log(this._handlers)\r\n    } else {\r\n      throw new Error(\"showmoney frame 未加载\");\r\n    }\r\n  }\r\n\r\n  public makeTx(params: MakeTxParamsTypes) {\r\n    const defParams: ObjTypes<any> = params;\r\n    if (params.callback) {\r\n      const handlerId = generateRandomId();\r\n      this._handlers[handlerId] = {};\r\n      this._handlers[handlerId].callback = params.callback;\r\n      defParams.handlerId = handlerId;\r\n    }\r\n    delete defParams.callback;\r\n    window.mainFrameMessage.send(\"make-tx\", defParams);\r\n  }\r\n\r\n  public payToAddress(params: { accessToken: string; callback?: Function; data: string }) {\r\n    const defParams: ObjTypes<any> = params;\r\n    if (params.callback) {\r\n      const handlerId = generateRandomId();\r\n      this._handlers[handlerId] = {};\r\n      this._handlers[handlerId].callback = params.callback;\r\n      defParams.handlerId = handlerId;\r\n    }\r\n    delete defParams.callback;\r\n    window.mainFrameMessage.send(\"pay-to-address\", defParams);\r\n  }\r\n  private handleCreateNodeSuccess = (res: ObjTypes<any>) => {\r\n    Popup.close();\r\n    this.mainFrameEl?.parentElement?.setAttribute(\"style\", \"display: none;\");\r\n    const payload = res.payload;\r\n    const callback = this._handlers[payload.handlerId].callback;\r\n    if (callback) {\r\n      callback(payload);\r\n    }\r\n  };\r\n  private showLoadingPopup() {\r\n    const popupEl = document.getElementById(\"showmoney-popup\");\r\n    if (!popupEl) return;\r\n    Popup.info({\r\n      message: \"Processing data...\",\r\n      showClose: false,\r\n    });\r\n    addClass(popupEl, \"loading\");\r\n  }\r\n  private handleCreateNodeError = (res: ObjTypes<any>) => {\r\n    const payload = res.payload;\r\n    Popup.close();\r\n    Popup.error({\r\n      message: payload.data && payload.data.message ? payload.data.message : res,\r\n    });\r\n  };\r\n  private handleConfirmCreateNode = (res: ObjTypes<any>) => {\r\n    // console.log(\"confirm\", res);\r\n    Popup.close();\r\n    this.mainFrameEl?.parentElement?.removeAttribute(\"style\");\r\n  };\r\n  private handleCloseCreateNode = (res: ObjTypes<any>) => {\r\n    Popup.close();\r\n    this.mainFrameEl?.parentElement?.setAttribute(\"style\", \"display: none;\");\r\n    const payload = res.payload;\r\n    const callback = this._handlers[payload.handlerId].onCancel;\r\n    if (callback) {\r\n      delete payload.handlerId;\r\n      callback(payload);\r\n    }\r\n  };\r\n  private handleErrorNotLoggedIn(resolve: ObjTypes<any>) {\r\n    const message = resolve.payload;\r\n    Popup.close();\r\n    Popup.info(message.popup);\r\n  }\r\n  private handleCallback = (res: ObjTypes<any>) => {\r\n    const payload = res.payload;\r\n    const callback = this._handlers[payload.handlerId].callback;\r\n    if (callback) {\r\n      delete payload.handlerId;\r\n      callback(payload);\r\n    }\r\n  };\r\n  private handleSdkLoaded = () => {\r\n    this.isLoaded = true;\r\n    if (typeof this.onLoaded === \"function\") {\r\n      this.onLoaded();\r\n    }\r\n  };\r\n  private handleCommonError = (res: ObjTypes<any>) => {\r\n    console.log(\"error\", res);\r\n    const payload = res.payload;\r\n    Popup.close();\r\n    if (payload.code === 202) {\r\n      Popup.confirm({\r\n        message: \"User authentication expired.\",\r\n        showClose: false,\r\n        buttonText: \"Cancel\",\r\n        buttonText2: \"Login\",\r\n        buttonUrl2: `${this.SHOWMONEY_URL}/userLogin?response_type=code&client_id=${this.oauthSettings.clientId}&redirect_uri=${this.oauthSettings.redirectUri}&scope=app&from=${this.oauthSettings.redirectUri}`,\r\n      });\r\n    } else {\r\n      this.onError(payload);\r\n    }\r\n  };\r\n  private handleLoading = () => {\r\n    this.showLoadingPopup();\r\n  };\r\n  private handleNotEnoughMoney = (res: ObjTypes<any>) => {\r\n    const payload = res.payload;\r\n    const message = payload.data.message;\r\n    Popup.close();\r\n    Popup.confirm({\r\n      message: message ? message : \"Not enough money\",\r\n      showClose: false,\r\n      buttonText: \"Cancel\",\r\n      buttonText2: \"Top up BSV\",\r\n      buttonUrl2: this.SHOWMONEY_URL,\r\n      buttonAction: () => {\r\n        Popup.close();\r\n        if ((window as any).handleNotEnoughMoney) {\r\n          (window as any).handleNotEnoughMoney(payload);\r\n        }\r\n        // const callback = this._handlers[payload.handlerId].callback\r\n        // if (callback) {\r\n        //   callback(payload)\r\n        // }\r\n      },\r\n    });\r\n  };\r\n  private init() {\r\n    this.injectMainFrame();\r\n\r\n    // 监听信息\r\n    this.postMessage.start();\r\n    this.initHandle();\r\n    this.postMessage.subscribe(\"sdk-loaded\", this.handleSdkLoaded);\r\n    this.postMessage.subscribe(\"error.not-logged-in\", this.handleErrorNotLoggedIn);\r\n    this.postMessage.subscribe(\"loading\", this.handleLoading);\r\n    this.postMessage.subscribe(\"success.create-node\", this.handleCreateNodeSuccess);\r\n    this.postMessage.subscribe(\"confirm.create-node\", this.handleConfirmCreateNode);\r\n    this.postMessage.subscribe(\"close.create-node\", this.handleCloseCreateNode);\r\n    this.postMessage.subscribe(\"error.create-node\", this.handleCreateNodeError);\r\n    this.postMessage.subscribe(\"error.not-enough-money\", this.handleNotEnoughMoney);\r\n    this.postMessage.subscribe(\"receive-callback\", this.handleCallback);\r\n    this.postMessage.subscribe(\"error.common\", this.handleCommonError);\r\n  }\r\n}\r\n","import { MetaIdJs } from \"./metaidjs\"\r\n\r\ndeclare global {\r\n  interface Window {\r\n    MetaIdJs?: Function; \r\n    handleNotEnoughMoney?: Function; \r\n  }\r\n}\r\n\r\nwindow.MetaIdJs = MetaIdJs\r\n\r\nexport default MetaIdJs"],"names":["css","ref","insertAt","document","head","getElementsByTagName","style","createElement","type","firstChild","insertBefore","appendChild","styleSheet","cssText","createTextNode","popupEl","setAttribute","body","this","popupWrapper","Popup","options","show","console","log","message","buttonAction","_this","close","popupDom","generatePopupContent","className","innerHTML","box","progress","bar1","bar2","popupHeader","popupTitle","title","closeBtn","onclick","showClose","popupContent","popupFooter","buttonText","button","innerText","buttonUrl","url_1","window","open","buttonText2","button2","buttonUrl2","url_2","useCurrentWindow","buttonAction2","event","data","v1","handler","handlers","topic","response","_a","reply","send","repliesTo","messageId","error","e_1","targetWindow","_pendingMessages","_deliverMessages","_replayQueue","PostmessageClient","addEventListener","_onMessageReceived","removeEventListener","payload","metadata","Math","floor","random","toString","postMessage","generateRandomId","addClass","el","cls","match","RegExp","hasClass","res","mainFrameEl","parentElement","callback","_handlers","handlerId","removeAttribute","onCancel","isLoaded","onLoaded","code","confirm","SHOWMONEY_URL","oauthSettings","clientId","redirectUri","onError","showLoadingPopup","handleNotEnoughMoney","baseUri","clientSecret","scope","responseType","init","MetaIdJs","mainFrame","mainFrameWrapper","onload","contentWindow","mainFrameMessage","isInjectMainFrame","item","this_1","params","defParams","functionObj_1","_i","sendMetaDataTx","needConfirm","checkOnly","Error","getElementById","info","resolve","popup","injectMainFrame","start","initHandle","subscribe","handleSdkLoaded","handleErrorNotLoggedIn","handleLoading","handleCreateNodeSuccess","handleConfirmCreateNode","handleCloseCreateNode","handleCreateNodeError","handleCallback","handleCommonError"],"mappings":"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"}